data-quality code
========================================================

## Install packages 

If the below packages are not installed already, then load package

```{r}
# install.packages(c('data.table','dplyr','stringr'))
# devtools::install_github("ropensci/alm", ref="alerts")
library('data.table')
library('dplyr')
library('stringr')
library('alm')
library('ggplot2')
```

## Read in data

PLOS folks, Monthly reports are in a Google Drive folder, talk to Martin

```{r}
setwd("~/Google Drive/ALM Monthly Reports/") 
files <- list.files(".", pattern = ".csv")
read_file <- function(x){
  tmp <- read.csv(x, header = TRUE, sep = ",", stringsAsFactors=FALSE)
  tmp$datafrom <- as.Date(str_extract(x, "[0-9]{4}-[0-9]{2}-[0-9]{2}"), "%Y-%m-%d")
  tmp
}
dat <- lapply(files, read_file)
alldat <- rbind_all(dat)
(dat2 <- tbl_df(alldat))
```

## Data manipulation

```{r}
# new column with date for each row, drop other pub date columns
# and move title to end for easier viewing
(dat2 <- dat2 %>%
  mutate(pubdate = published[1], title2 = title) %>%
  select(-published, -publication_date, -title))

# remove negative numbers in facebook
(dat2 <- dat2 %>%
  filter(facebook >= 0))
```

## Through time

Compare each metric separately through time for the same DOIs

### Citeulike data

```{r}
citeulike <- dat2 %>% select(doi, datafrom, citeulike)
ggplot(citeulike[1:100000,], aes(datafrom, citeulike, group=doi)) +
  geom_line()

# get dois that have at least a change in their value of 1  
citeu_dois <- dat2 %>% 
  select(doi, datafrom, citeulike) %>% 
  group_by(doi) %>% 
  summarise(
    diff = max(citeulike) - min(citeulike)
  ) %>% 
  filter(diff > 10) %>% 
  select(doi)

# Visualize data
dat2 %>% 
  select(doi, datafrom, citeulike) %>% 
  filter(doi %in% citeu_dois$doi) %>% 
  ggplot(aes(datafrom, citeulike, group=doi)) + geom_line()
```

## Across metrics

Compare different metrics across the same DOIs in one time slice

```{r}
# xxx
```
